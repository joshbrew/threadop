(()=>{function K(i=T=>T,{imports:O,message:E,transfer:a,port:e,blocking:s,pool:g,loop:o,animate:p,callback:S}={}){return new Promise((T,C)=>{let b;if(typeof i!="function"){if(typeof i=="string"&&i.startsWith("./")){let c=location.origin,l=location.pathname.split("/");l.pop();let R=l.join("/");R.startsWith("http")?c+="/":c+=R+"/",i=c+i}b=i}else b=y(i,O);let D=c=>{let l={},R=!1;c.onmessage=n=>{for(let t in l)l[t](n.data.message,n.data.cb)},c.onerror=n=>{console.error(new Error("Worker encountered an error: "+n.message))};let d=(n,t)=>new Promise((r,h)=>{if(c.PORTS)c.postMessage({message:n},t),r(!0);else{if(s){if(R)return new Promise((m,W)=>{W("Thread Blocked")});R=!0}let u=Math.random();l[u]=(m,W)=>{u===W&&(delete l[u],s&&(R=!1),r(m))},c.postMessage({message:n,cb:u},t)}}),f={run:(n,t)=>d(n,t),terminate:()=>{if(URL.revokeObjectURL(b),c.terminate(),c.PORTS){let n=(t,r)=>{t.postMessage({COMMAND:{DELETED:c.id}})};c.PORTS.forEach(n)}},addPort:n=>M(c,n,c.id,s),addCallback:(n=r=>{},t)=>{let r=Math.random();return l[r]=t?h=>{n(h),delete l[r]}:n,r},removeCallback:n=>{delete f.callbacks[n]},setLoop:(n,t,r)=>{c.postMessage({message:t,COMMAND:{SETLOOP:n}},r)},setAnimation:(n,t)=>{c.postMessage({message:n,COMMAND:{SETANIM:!0}},t)},stop:()=>{c.postMessage({COMMAND:{STOP:!0}})},worker:c,callbacks:l};return S&&f.addCallback(S),o?f.setLoop(o,E,a):p&&f.setAnimation(E,a),f};if(g){let c=function(){let f=new Worker(b,O||typeof i!="function"?{type:"module"}:void 0),n=Math.random();return f.id=n,l[n]=f,n},l={},R={};for(let f=0;f<g;f++)c();let d=Object.keys(l);if(e&&d.forEach((f,n)=>{let t=l[f];Array.isArray(e)?M(t,e[n],t.id,s):M(t,e,t.id,s)}),E&&!o&&!p)Promise.all(d.map((f,n)=>{let t=l[f],r=Array.isArray(E)?E[n]:E;return new Promise((h,u)=>{t.onmessage=W=>{Promise.resolve().then(()=>{t.terminate(),delete l[t.id]}),h(W.data.message)},t.onerror=W=>{Promise.resolve().then(()=>{t.terminate(),delete l[t.id]}),u(new Error("Worker encountered an error: "+W.message))};let m={message:r,oneOff:!0};t.postMessage(m,a)})})).then(f=>{URL.revokeObjectURL(b),T(f)}).catch(f=>{URL.revokeObjectURL(b),Object.keys(l).map((n,t)=>{let r=l[n];r&&r.terminate(),delete l[n],delete R.helpers?.[n]}),C(f)});else{let f=0;Object.assign(R,{workers:l,helpers:{},keys:d,run:(t,r,h)=>{if(h)R.helpers[h]?.run(t,r);else if(Array.isArray(t)){let u=t.length;for(let m=0;m<u;m++)R.helpers[d[f]].run(t[m],r[m]),f++,f>=d.length&&(f=0)}else R.helpers[d[f]].run(t,r),f++,f>=d.length&&(f=0)},terminate:t=>{function r(h){R.helpers[h]?.terminate(),delete R.helpers[h],delete R.workers[h]}t?r(t):d.forEach(r)},addWorker:()=>{let t=c(),r=l[t];return n(r),d.length=0,d.push(...d),t},addPort:(t,r)=>{function h(u){return R.helpers[u]?.addPort(t),!0}return r?h(r):d.map(h)},addCallback:(t,r,h)=>{function u(m){return R.helpers[m]?.addCallback(t,r)}return h?u(h):d.map(u)},removeCallback:(t,r)=>{function h(u){return R.helpers[u]?.removeCallback(t),!0}return r?h(r):d.map(h)},setLoop:(t,r,h,u)=>{function m(W){R.helpers[W]?.setLoop(t,r,h)}return u?m(u):d.map(m)},setAnimation:(t,r,h)=>{function u(m){R.helpers[m]?.setAnimation(t,r)}return h?u(h):d.map(u)},stop:t=>{function r(h){R.helpers[h]?.stop()}return t?r(t):d.map(r)}});let n=t=>{R.helpers[t.id]=D(t)};Object.keys(l).forEach((t,r)=>{n(l[t])}),T(R)}}else{let c=Math.random(),l=new Worker(b,O||typeof i!="function"?{type:"module"}:void 0);if(l.id=c,e&&(Array.isArray(e)?e.map(R=>{M(l,R,c,s)}):M(l,e,c,s)),E&&!o&&!p)l.onmessage=R=>{Promise.resolve().then(()=>{l.terminate(),URL.revokeObjectURL(b)}),T(R.data.message)},l.onerror=R=>{Promise.resolve().then(()=>{l.terminate(),URL.revokeObjectURL(b)}),C(new Error("Worker encountered an error: "+R.message))},l.postMessage({message:E,oneOff:!0},a);else{let R=D(l);T(R)}}})}function A(i){let O=location.pathname.split("/");O.pop();let E=location.origin+O.join("/")+"/";return typeof i=="string"?(i.startsWith("./")&&(i=E+i),i.includes("import")?`${i}`:`import '${i}';`):Array.isArray(i)?i.map(a=>(a.startsWith("./")&&(a=E+a),a.includes("import")?a:`import '${a}';`)).join(`
`):typeof i=="object"?Object.entries(i).map(([e,s])=>(e.startsWith("./")&&(e=E+e),typeof s=="string"?`import ${s} from '${e}';`:typeof s=="boolean"&&s?`import '${e}'`:`import { ${Object.entries(s).map(([o,p])=>typeof p=="string"?`${o} as ${p}`:o).join(", ")} } from '${e}';`)).join(`
`)+"":""}function M(i,O,E,a){let e=new MessageChannel;i.postMessage({COMMAND:{SENDER:e.port1,id:E,blocking:a}},[e.port1]),O.postMessage({COMMAND:{RECEIVER:e.port2,id:E,blocking:a}},[e.port2]),i.PORTS||(i.PORTS=[]),i.PORTS.push(O),O.PORTS||(O.PORTS=[]),O.PORTS.push(i)}var L=(i=()=>{})=>{globalThis.WORKER={};let O=(a,e,s)=>{if(globalThis.WORKER.SENDERS)for(let g in globalThis.WORKER.SENDERS){if(globalThis.WORKER.BLOCKING[g]){if(globalThis.WORKER.BLOCKED[g]){console.error("Thread Blocked: "+g);continue}globalThis.WORKER.BLOCKED[g]=!0}globalThis.WORKER.SENDERS[g].postMessage({message:a,cb:e}),s&&postMessage(!0)}else postMessage({message:a,cb:e})},E=(a,e)=>{let s=i(a.data?.message);s?.then?s.then(g=>{e&&e.postMessage(!0),O(g,a.data.cb,a.data.oneOff)}):(e&&e.postMessage(!0),O(s,a.data.cb,a.data.oneOff))};globalThis.onmessage=a=>{if(a.data?.COMMAND){let e=a.data.COMMAND;if(typeof e.SETLOOP=="number"){globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP);let s=()=>{E(a),globalThis.WORKER.LOOP=setTimeout(()=>{s()},e.SETLOOP)};s()}if(e.SETANIM){globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM);let s=()=>{E(a),globalThis.WORKER.ANIM=requestAnimationFrame(()=>{s()})};s()}if(e.STOP&&(globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP),globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM)),e.RECEIVER){let s=e.blocking;globalThis.WORKER.RECEIVERS||(globalThis.WORKER.RTCR=0,globalThis.WORKER.RECEIVERS={});let g=e.id;globalThis.WORKER.RECEIVERS[g]=e.RECEIVER,globalThis.WORKER.RTCR++,e.RECEIVER.onmessage=o=>{E(o,s?e.RECEIVER:void 0)},e.RECEIVER.onerror=o=>{delete globalThis.WORKER.RECEIVERS[g]}}if(e.SENDER){globalThis.WORKER.SENDERS||(globalThis.WORKER.PCTR=0,globalThis.WORKER.SENDERS={},globalThis.WORKER.BLOCKING={},globalThis.WORKER.BLOCKED={});let s=e.blocking,g=e.id?e.id:globalThis.WORKER.PCTR;globalThis.WORKER.SENDERS[g]=e.SENDER,globalThis.WORKER.PCTR++,s&&(globalThis.WORKER.BLOCKING[g]=!0),e.SENDER.onmessage=o=>{globalThis.WORKER.BLOCKING[g]&&(globalThis.WORKER.BLOCKED[g]=!1)},e.SENDER.onerror=o=>{delete globalThis.WORKER.SENDERS[g]}}e.DELETED&&(delete globalThis.WORKER.RECEIVERS?.[e.DELETED],delete globalThis.WORKER.SENDERS?.[e.DELETED])}else E(a)},globalThis.onerror=a=>{console.error(a)}},N=L.toString(),y=(i,O)=>{let E=N.replace("()=>{}",i.toString()),e=`${A(O)}
(${E})()`,s=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(s)};async function P(i){let O=i.length;if(O<=1)return i;let E=[],a=[];for(let o=0;o<O;o+=2)E.push(i[o]),o+1<O&&a.push(i[o+1]);let e,s;E.length>=7500?[e,s]=await Promise.all([K("./fft.thread.js",{message:E}),K("./fft.thread.js",{message:a})]):[e,s]=[await P(E),await P(a)];let g=new Array(O);for(let o=0;o<O/2;o++){let p=-2*Math.PI*o/O,S=Math.cos(p)*s[o].real-Math.sin(p)*s[o].imag,T=Math.cos(p)*s[o].imag+Math.sin(p)*s[o].real;g[o]={real:e[o].real+S,imag:e[o].imag+T},g[o+O/2]={real:e[o].real-S,imag:e[o].imag-T}}return g}L(P);})();
