(()=>{function P(a=f=>f,{imports:h,message:d,transfer:e,port:t,blocking:i,pool:E,loop:l,animate:M,callback:K}={}){return new Promise((f,D)=>{let u;if(typeof a!="function"){if(typeof a=="string"&&a.startsWith("./")){let O=location.origin,n=location.pathname.split("/");n.pop();let R=n.join("/");R.startsWith("http")?O+="/":O+=R+"/",a=O+a}u=a}else u=y(a,h);let N=O=>{let n={},R=!1;O.onmessage=s=>{for(let o in n)n[o](s.data.message,s.data.cb)},O.onerror=s=>{console.error(new Error("Worker encountered an error: "+s.message))};let p=(s,o,r)=>new Promise((g,c)=>{if(!r&&O.PORTS)O.postMessage({message:s,overridePort:r},o),g(!0);else{if(i){if(R)return new Promise((T,S)=>{S("Thread Blocked")});R=!0}let b=Math.random();n[b]=(T,S)=>{b===S&&(delete n[b],i&&(R=!1),g(T))},O.postMessage({message:s,cb:b,overridePort:r},o)}}),m={run:(s,o,r)=>p(s,o,r),terminate:()=>{if(URL.revokeObjectURL(u),O.terminate(),O.PORTS){let s=(o,r)=>{o.postMessage({COMMAND:{DELETED:O.id}})};O.PORTS.forEach(s)}},addPort:s=>W(O,s,i),addCallback:(s=r=>{},o)=>{let r=Math.random();return n[r]=o?g=>{s(g),delete n[r]}:s,r},removeCallback:s=>{delete m.callbacks[s]},setLoop:(s,o,r)=>{O.postMessage({message:o,COMMAND:{SETLOOP:s}},r)},setAnimation:(s,o)=>{O.postMessage({message:s,COMMAND:{SETANIM:!0}},o)},stop:()=>{O.postMessage({COMMAND:{STOP:!0}})},worker:O,callbacks:n,id:O.id};return K&&m.addCallback(K),l?m.setLoop(l,d,e):M&&m.setAnimation(d,e),m};if(E){let O=function(){let m=new Worker(u,h||typeof a!="function"?{type:"module"}:void 0),s=Math.random();return m.id=s,n[s]=m,s},n={},R={};for(let m=0;m<E;m++)O();let p=Object.keys(n);if(t&&p.forEach((m,s)=>{let o=n[m];Array.isArray(t)?t.length===p.length?W(o,t[s],i):t.forEach(r=>{W(o,r,i)}):W(o,t,i)}),d&&!l&&!M)Promise.all(p.map((m,s)=>{let o=n[m],r=Array.isArray(d)?d[s]:d;return new Promise((g,c)=>{o.onmessage=T=>{Promise.resolve().then(()=>{o.terminate(),delete n[o.id]}),g(T.data.message)},o.onerror=T=>{Promise.resolve().then(()=>{o.terminate(),delete n[o.id]}),c(new Error("Worker encountered an error: "+T.message))};let b={message:r,oneOff:!0};o.postMessage(b,e)})})).then(m=>{URL.revokeObjectURL(u),f(m)}).catch(m=>{URL.revokeObjectURL(u),Object.keys(n).map((s,o)=>{let r=n[s];r&&r.terminate(),delete n[s],delete R.helpers?.[s]}),D(m)});else{let m=0;Object.assign(R,{workers:n,helpers:{},keys:p,run:(o,r,g,c)=>{if(c)return R.helpers[c]?.run(o,r);if(Array.isArray(o)){let b=o.length,T=[];for(let S=0;S<b;S++){let L=R.helpers[p[m]].run(o[S],r[S],g);m++,m>=p.length&&(m=0),T.push(L)}return T}else{let b=R.helpers[p[m]].run(o,r,g);return m++,m>=p.length&&(m=0),b}},terminate:o=>{function r(g){R.helpers[g]?.terminate(),delete R.helpers[g],delete R.workers[g]}o?r(o):p.forEach(r)},addWorker:()=>{let o=O(),r=n[o];return s(r),p.length=0,p.push(...p),o},addPort:(o,r)=>{function g(c){return R.helpers[c]?.addPort(o),!0}return r?g(r):p.map(g)},addCallback:(o,r,g)=>{function c(b){return R.helpers[b]?.addCallback(o,r)}return g?c(g):p.map(c)},removeCallback:(o,r)=>{function g(c){return R.helpers[c]?.removeCallback(o),!0}return r?g(r):p.map(g)},setLoop:(o,r,g,c)=>{function b(T){R.helpers[T]?.setLoop(o,r,g)}return c?b(c):p.map(b)},setAnimation:(o,r,g)=>{function c(b){R.helpers[b]?.setAnimation(o,r)}return g?c(g):p.map(c)},stop:o=>{function r(g){R.helpers[g]?.stop()}return o?r(o):p.map(r)}});let s=o=>{R.helpers[o.id]=N(o)};Object.keys(n).forEach((o,r)=>{s(n[o])}),f(R)}}else{let O=Math.random(),n=new Worker(u,h||typeof a!="function"?{type:"module"}:void 0);if(n.id=O,t&&(t.id||(t.id=Math.random()),Array.isArray(t)?t.map(R=>{W(n,R,i)}):W(n,t,i)),d&&!l&&!M)n.onmessage=R=>{Promise.resolve().then(()=>{n.terminate(),URL.revokeObjectURL(u)}),f(R.data.message)},n.onerror=R=>{Promise.resolve().then(()=>{n.terminate(),URL.revokeObjectURL(u)}),D(new Error("Worker encountered an error: "+R.message))},n.postMessage({message:d,oneOff:!0},e);else{let R=N(n);f(R)}}})}function v(a){let h=location.pathname.split("/");h.pop();let d=location.origin+h.join("/")+"/";return typeof a=="string"?(a.startsWith("./")&&(a=d+a),a.includes("import")?`${a}`:`import '${a}';`):Array.isArray(a)?a.map(e=>(e.startsWith("./")&&(e=d+e),e.includes("import")?e:`import '${e}';`)).join(`
`):typeof a=="object"?Object.entries(a).map(([e,t])=>(e.startsWith("./")&&(e=d+e),typeof t=="string"?`import ${t} from '${e}';`:typeof t=="boolean"&&t?`import '${e}'`:`import { ${Object.entries(t).map(([i,E])=>typeof E=="string"?`${i} as ${E}`:i).join(", ")} } from '${e}';`)).join(`
`)+"":""}function W(a,h,d){let e=new MessageChannel;a.id||(a.id=Math.random()),h.id||(h.id=Math.random()),a.postMessage({COMMAND:{SENDER:e.port1,id:h.id,blocking:d}},[e.port1]),h.postMessage({COMMAND:{RECEIVER:e.port2,id:a.id,blocking:d}},[e.port2]),a.PORTS||(a.PORTS=[]),a.PORTS.push(h),h.PORTS||(h.PORTS=[]),h.PORTS.push(a)}var k=(a=()=>{})=>{globalThis.WORKER={},a=a.bind(globalThis.WORKER);let h=(e,t,i,E)=>{if(globalThis.WORKER.SENDERS&&E!==!0)if(E!==void 0&&E!=="both")globalThis.WORKER.SENDERS[E]&&(e?.message?globalThis.WORKER.SENDERS[E].postMessage({message:e.message,overridePort:e?.overridePort},e.transfer):globalThis.WORKER.SENDERS[E].postMessage({message:e,overridePort:e?.overridePort}));else{for(let l in globalThis.WORKER.SENDERS){if(globalThis.WORKER.BLOCKING[l]){if(globalThis.WORKER.BLOCKED[l]){console.error("Thread Blocked: "+l);continue}globalThis.WORKER.BLOCKED[l]=!0}e?.message?globalThis.WORKER.SENDERS[l].postMessage({message:e.message,overridePort:e?.overridePort},e.transfer):globalThis.WORKER.SENDERS[l].postMessage({message:e,overridePort:e?.overridePort})}i&&postMessage(!0)}(!globalThis.WORKER.SENDERS||E===!0||E==="both")&&(e?.message?postMessage({message:e.message,cb:t,overridePort:e?.overridePort},e.transfer):postMessage({message:e,cb:t,overridePort:e?.overridePort}))},d=(e,t)=>{let i=a(e.data?.message);i?.then?i.then(E=>{t&&t.postMessage(!0),h(E,e.data.cb,e.data.oneOff,e.data.overridePort)}):(t&&t.postMessage(!0),h(i,e.data.cb,e.data.oneOff,e.data.overridePort))};globalThis.onmessage=e=>{if(e.data?.COMMAND){let t=e.data.COMMAND;if(typeof t.SETLOOP=="number"){globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP);let i=()=>{d(e),globalThis.WORKER.LOOP=setTimeout(()=>{i()},t.SETLOOP)};i()}if(t.SETANIM){globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM);let i=()=>{d(e),globalThis.WORKER.ANIM=requestAnimationFrame(()=>{i()})};i()}if(t.STOP&&(globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP),globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM)),t.RECEIVER){let i=t.blocking;globalThis.WORKER.RECEIVERS||(globalThis.WORKER.RTCR=0,globalThis.WORKER.RECEIVERS={});let E=t.id;globalThis.WORKER.RECEIVERS[E]=t.RECEIVER,globalThis.WORKER.RTCR++,t.RECEIVER.onmessage=l=>{d(l,i?t.RECEIVER:void 0)},t.RECEIVER.onerror=l=>{delete globalThis.WORKER.RECEIVERS[E]}}if(t.SENDER){globalThis.WORKER.SENDERS||(globalThis.WORKER.PCTR=0,globalThis.WORKER.SENDERS={},globalThis.WORKER.BLOCKING={},globalThis.WORKER.BLOCKED={});let i=t.blocking,E=t.id?t.id:globalThis.WORKER.PCTR;globalThis.WORKER.SENDERS[E]=t.SENDER,globalThis.WORKER.PCTR++,i&&(globalThis.WORKER.BLOCKING[E]=!0),t.SENDER.onmessage=l=>{globalThis.WORKER.BLOCKING[E]&&(globalThis.WORKER.BLOCKED[E]=!1)},t.SENDER.onerror=l=>{delete globalThis.WORKER.SENDERS[E]}}t.DELETED&&(delete globalThis.WORKER.RECEIVERS?.[t.DELETED],delete globalThis.WORKER.SENDERS?.[t.DELETED])}else d(e)},globalThis.onerror=e=>{console.error(e)}},A=k.toString(),y=(a,h)=>{let d=A.replace("()=>{}",a.toString()),e=`${v(h)}

(${d})()`,t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)};async function C(a){let h=a.length;if(h<=1)return a;let d=[],e=[];for(let l=0;l<h;l+=2)d.push(a[l]),l+1<h&&e.push(a[l+1]);let t,i;d.length>=7500?[t,i]=await Promise.all([P("./fft.thread.js",{message:d}),P("./fft.thread.js",{message:e})]):[t,i]=[await C(d),await C(e)];let E=new Array(h);for(let l=0;l<h/2;l++){let M=-2*Math.PI*l/h,K=Math.cos(M)*i[l].real-Math.sin(M)*i[l].imag,f=Math.cos(M)*i[l].imag+Math.sin(M)*i[l].real;E[l]={real:t[l].real+K,imag:t[l].imag+f},E[l+h/2]={real:t[l].real-K,imag:t[l].imag-f}}return E}k(C);})();
