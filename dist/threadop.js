(()=>{var D=Object.defineProperty;var A=(o,f)=>{for(var m in f)D(o,m,{get:f[m],enumerable:!0})};var k={};A(k,{default:()=>v,generateWorkerURL:()=>I,initWorker:()=>C,threadop:()=>K,workerFnString:()=>L});function K(o=W=>W,{imports:f,message:m,transfer:i,port:r,blocking:l,pool:c,loop:E,animate:T,callback:P}={}){return new Promise((W,S)=>{let h;if(typeof o!="function"){if(typeof o=="string"&&o.startsWith("./")){let n=location.origin,a=location.pathname.split("/");a.pop();let R=a.join("/");R.startsWith("http")?n+="/":n+=R+"/",o=n+o}h=o}else h=I(o,f);let M=n=>{let a={},R=!1;n.onmessage=s=>{for(let e in a)a[e](s.data.message,s.data.cb)},n.onerror=s=>{console.error(new Error("Worker encountered an error: "+s.message))};let u=(s,e)=>new Promise((t,p)=>{if(n.PORTS)n.postMessage({message:s},e),t(!0);else{if(l){if(R)return new Promise((g,O)=>{O("Thread Blocked")});R=!0}let d=Math.random();a[d]=(g,O)=>{d===O&&(delete a[d],l&&(R=!1),t(g))},n.postMessage({message:s,cb:d},e)}}),b={run:(s,e)=>u(s,e),terminate:()=>{if(URL.revokeObjectURL(h),n.terminate(),n.PORTS){let s=(e,t)=>{e.postMessage({COMMAND:{DELETED:n.id}})};n.PORTS.forEach(s)}},addPort:s=>y(n,s,n.id,l),addCallback:(s=t=>{},e)=>{let t=Math.random();return a[t]=e?p=>{s(p),delete a[t]}:s,t},removeCallback:s=>{delete b.callbacks[s]},setLoop:(s,e,t)=>{n.postMessage({message:e,COMMAND:{SETLOOP:s}},t)},setAnimation:(s,e)=>{n.postMessage({message:s,COMMAND:{SETANIM:!0}},e)},stop:()=>{n.postMessage({COMMAND:{STOP:!0}})},worker:n,callbacks:a};return P&&b.addCallback(P),E?b.setLoop(E,m,i):T&&b.setAnimation(m,i),b};if(c){let R=function(){let b=new Worker(h,f||typeof o!="function"?{type:"module"}:void 0),s=Math.random();return b.id=s,n[s]=b,s},n={},a={};for(let b=0;b<c;b++)R();let u=Object.keys(n);if(r&&u.forEach((b,s)=>{let e=n[b];Array.isArray(r)?y(e,r[s],e.id,l):y(e,r,e.id,l)}),m&&!E&&!T)Promise.all(u.map((b,s)=>{let e=n[b],t=Array.isArray(m)?m[s]:m;return new Promise((p,d)=>{e.onmessage=O=>{Promise.resolve().then(()=>{e.terminate(),delete n[e.id]}),p(O.data.message)},e.onerror=O=>{Promise.resolve().then(()=>{e.terminate(),delete n[e.id]}),d(new Error("Worker encountered an error: "+O.message))};let g={message:t,oneOff:!0};e.postMessage(g,i)})})).then(b=>{URL.revokeObjectURL(h),W(b)}).catch(b=>{URL.revokeObjectURL(h),Object.keys(n).map((s,e)=>{let t=n[s];t&&t.terminate(),delete n[s],delete a.helpers?.[s]}),S(b)});else{let b=0;Object.assign(a,{workers:n,helpers:{},keys:u,run:(e,t,p)=>{if(p)a.helpers[p]?.run(e,t);else if(Array.isArray(e)){let d=e.length;for(let g=0;g<d;g++)a.helpers[u[b]].run(e[g],t[g]),b++,b>=u.length&&(b=0)}else a.helpers[u[b]].run(e,t),b++,b>=u.length&&(b=0)},terminate:e=>{function t(p){a.helpers[p]?.terminate(),delete a.helpers[p],delete a.workers[p]}e?t(e):u.forEach(t)},addWorker:()=>{let e=R(),t=n[e];return s(t),u.length=0,u.push(...u),e},addPort:(e,t)=>{function p(d){return a.helpers[d]?.addPort(e),!0}return t?p(t):u.map(p)},addCallback:(e,t,p)=>{function d(g){return a.helpers[g]?.addCallback(e,t)}return p?d(p):u.map(d)},removeCallback:(e,t)=>{function p(d){return a.helpers[d]?.removeCallback(e),!0}return t?p(t):u.map(p)},setLoop:(e,t,p,d)=>{function g(O){a.helpers[O]?.setLoop(e,t,p)}return d?g(d):u.map(g)},setAnimation:(e,t,p)=>{function d(g){a.helpers[g]?.setAnimation(e,t)}return p?d(p):u.map(d)},stop:e=>{function t(p){a.helpers[p]?.stop()}return e?t(e):u.map(t)}});let s=e=>{a.helpers[e.id]=M(e)};Object.keys(n).forEach((e,t)=>{s(n[e])}),W(a)}}else{let n=Math.random(),a=new Worker(h,f||typeof o!="function"?{type:"module"}:void 0);if(a.id=n,r&&(Array.isArray(r)?r.map(R=>{y(a,R,n,l)}):y(a,r,n,l)),m&&!E&&!T)a.onmessage=R=>{Promise.resolve().then(()=>{a.terminate(),URL.revokeObjectURL(h)}),W(R.data.message)},a.onerror=R=>{Promise.resolve().then(()=>{a.terminate(),URL.revokeObjectURL(h)}),S(new Error("Worker encountered an error: "+R.message))},a.postMessage({message:m,oneOff:!0},i);else{let R=M(a);W(R)}}})}function N(o){let f=location.pathname.split("/");f.pop();let m=location.origin+f.join("/")+"/";return typeof o=="string"?(o.startsWith("./")&&(o=m+o),o.includes("import")?`${o}`:`import '${o}';`):Array.isArray(o)?o.map(i=>(i.startsWith("./")&&(i=m+i),i.includes("import")?i:`import '${i}';`)).join(`
`):typeof o=="object"?Object.entries(o).map(([r,l])=>(r.startsWith("./")&&(r=m+r),typeof l=="string"?`import ${l} from '${r}';`:typeof l=="boolean"&&l?`import '${r}'`:`import { ${Object.entries(l).map(([E,T])=>typeof T=="string"?`${E} as ${T}`:E).join(", ")} } from '${r}';`)).join(`
`)+"":""}function y(o,f,m,i){let r=new MessageChannel;o.postMessage({COMMAND:{SENDER:r.port1,id:m,blocking:i}},[r.port1]),f.postMessage({COMMAND:{RECEIVER:r.port2,id:m,blocking:i}},[r.port2]),o.PORTS||(o.PORTS=[]),o.PORTS.push(f),f.PORTS||(f.PORTS=[]),f.PORTS.push(o)}var C=(o=()=>{})=>{globalThis.WORKER={};let f=(i,r,l)=>{if(globalThis.WORKER.SENDERS)for(let c in globalThis.WORKER.SENDERS){if(globalThis.WORKER.BLOCKING[c]){if(globalThis.WORKER.BLOCKED[c]){console.error("Thread Blocked: "+c);continue}globalThis.WORKER.BLOCKED[c]=!0}globalThis.WORKER.SENDERS[c].postMessage({message:i,cb:r}),l&&postMessage(!0)}else postMessage({message:i,cb:r})},m=(i,r)=>{let l=o(i.data?.message);l?.then?l.then(c=>{r&&r.postMessage(!0),f(c,i.data.cb,i.data.oneOff)}):(r&&r.postMessage(!0),f(l,i.data.cb,i.data.oneOff))};globalThis.onmessage=i=>{if(i.data?.COMMAND){let r=i.data.COMMAND;if(typeof r.SETLOOP=="number"){globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP);let l=()=>{m(i),globalThis.WORKER.LOOP=setTimeout(()=>{l()},r.SETLOOP)};l()}if(r.SETANIM){globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM);let l=()=>{m(i),globalThis.WORKER.ANIM=requestAnimationFrame(()=>{l()})};l()}if(r.STOP&&(globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP),globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM)),r.RECEIVER){let l=r.blocking;globalThis.WORKER.RECEIVERS||(globalThis.WORKER.RTCR=0,globalThis.WORKER.RECEIVERS={});let c=r.id;globalThis.WORKER.RECEIVERS[c]=r.RECEIVER,globalThis.WORKER.RTCR++,r.RECEIVER.onmessage=E=>{m(E,l?r.RECEIVER:void 0)},r.RECEIVER.onerror=E=>{delete globalThis.WORKER.RECEIVERS[c]}}if(r.SENDER){globalThis.WORKER.SENDERS||(globalThis.WORKER.PCTR=0,globalThis.WORKER.SENDERS={},globalThis.WORKER.BLOCKING={},globalThis.WORKER.BLOCKED={});let l=r.blocking,c=r.id?r.id:globalThis.WORKER.PCTR;globalThis.WORKER.SENDERS[c]=r.SENDER,globalThis.WORKER.PCTR++,l&&(globalThis.WORKER.BLOCKING[c]=!0),r.SENDER.onmessage=E=>{globalThis.WORKER.BLOCKING[c]&&(globalThis.WORKER.BLOCKED[c]=!1)},r.SENDER.onerror=E=>{delete globalThis.WORKER.SENDERS[c]}}r.DELETED&&(delete globalThis.WORKER.RECEIVERS?.[r.DELETED],delete globalThis.WORKER.SENDERS?.[r.DELETED])}else m(i)},globalThis.onerror=i=>{console.error(i)}},L=C.toString(),I=(o,f)=>{let m=L.replace("()=>{}",o.toString()),r=`${N(f)}
(${m})()`,l=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(l)},v=K;["threadop","initWorker"].forEach(o=>{k[o]&&(globalThis[o]=k[o])});})();
