(()=>{var I=Object.defineProperty;var A=(n,u)=>{for(var p in u)I(n,p,{get:u[p],enumerable:!0})};var k={};A(k,{default:()=>v,generateWorkerURL:()=>D,initWorker:()=>C,threadop:()=>K,workerFnString:()=>L});function K(n=W=>W,{imports:u,message:p,transfer:t,port:r,blocking:l,pool:f,loop:E,animate:T,callback:P}={}){return new Promise((W,S)=>{let h;if(typeof n!="function"){if(typeof n=="string"&&n.startsWith("./")){let a=location.origin,s=location.pathname.split("/");s.pop();let c=s.join("/");c.startsWith("http")?a+="/":a+=c+"/",n=a+n}h=n}else h=D(n,u);let M=a=>{let s={},c=!1;a.onmessage=i=>{for(let e in s)s[e](i.data.message,i.data.cb)},a.onerror=i=>{console.error(new Error("Worker encountered an error: "+i.message))};let R=(i,e)=>new Promise((o,m)=>{if(a.PORTS)a.postMessage({message:i},e),o(!0);else{if(l){if(c)return new Promise((g,O)=>{O("Thread Blocked")});c=!0}let d=Math.random();s[d]=(g,O)=>{d===O&&(delete s[d],l&&(c=!1),o(g))},a.postMessage({message:i,cb:d},e)}}),b={run:(i,e)=>R(i,e),terminate:()=>{if(URL.revokeObjectURL(h),a.terminate(),a.PORTS){let i=(e,o)=>{e.postMessage({COMMAND:{DELETED:a.id}})};a.PORTS.forEach(i)}},addPort:i=>y(a,i,a.id,l),addCallback:(i=o=>{},e)=>{let o=Math.random();return s[o]=e?m=>{i(m),delete s[o]}:i,o},removeCallback:i=>{delete b.callbacks[i]},setLoop:(i,e,o)=>{a.postMessage({message:e,COMMAND:{SETLOOP:i}},o)},setAnimation:(i,e)=>{a.postMessage({message:i,COMMAND:{SETANIM:!0}},e)},stop:()=>{a.postMessage({COMMAND:{STOP:!0}})},worker:a,callbacks:s};return P&&b.addCallback(P),E?b.setLoop(E,p,t):T&&b.setAnimation(p,t),b};if(f){let c=function(){let b=new Worker(h,u||typeof n!="function"?{type:"module"}:void 0),i=Math.random();return b.id=i,a[i]=b,i},a={},s={};for(let b=0;b<f;b++)c();let R=Object.keys(a);if(r&&R.forEach((b,i)=>{let e=a[b];Array.isArray(r)?y(e,r[i],e.id,l):y(e,r,e.id,l)}),p&&!E&&!T)Promise.all(R.map((b,i)=>{let e=a[b],o=Array.isArray(p)?p[i]:p;return new Promise((m,d)=>{e.onmessage=O=>{Promise.resolve().then(()=>{e.terminate(),delete a[e.id]}),m(O.data.message)},e.onerror=O=>{Promise.resolve().then(()=>{e.terminate(),delete a[e.id]}),d(new Error("Worker encountered an error: "+O.message))};let g={message:o,oneOff:!0};e.postMessage(g,t)})})).then(b=>{URL.revokeObjectURL(h),W(b)}).catch(b=>{URL.revokeObjectURL(h),Object.keys(a).map((i,e)=>{let o=a[i];o&&o.terminate(),delete a[i],delete s.helpers?.[i]}),S(b)});else{let b=0;Object.assign(s,{workers:a,helpers:{},keys:R,run:(e,o,m)=>{if(m)s.helpers[m]?.run(e,o);else if(Array.isArray(e)){let d=e.length;for(let g=0;g<d;g++)s.helpers[R[b]].run(e[g],o[g]),b++,b>=R.length&&(b=0)}else s.helpers[R[b]].run(e,o),b++,b>=R.length&&(b=0)},terminate:e=>{function o(m){s.helpers[m]?.terminate(),delete s.helpers[m],delete s.workers[m]}e?o(e):R.forEach(o)},addWorker:()=>{let e=c(),o=a[e];return i(o),R.length=0,R.push(...R),e},addPort:(e,o)=>{function m(d){return s.helpers[d]?.addPort(e),!0}return o?m(o):R.map(m)},addCallback:(e,o,m)=>{function d(g){return s.helpers[g]?.addCallback(e,o)}return m?d(m):R.map(d)},removeCallback:(e,o)=>{function m(d){return s.helpers[d]?.removeCallback(e),!0}return o?m(o):R.map(m)},setLoop:(e,o,m,d)=>{function g(O){s.helpers[O]?.setLoop(e,o,m)}return d?g(d):R.map(g)},setAnimation:(e,o,m)=>{function d(g){s.helpers[g]?.setAnimation(e,o)}return m?d(m):R.map(d)},stop:e=>{function o(m){s.helpers[m]?.stop()}return e?o(e):R.map(o)}});let i=e=>{s.helpers[e.id]=M(e)};Object.keys(a).forEach((e,o)=>{i(a[e])}),W(s)}}else{let a=Math.random(),s=new Worker(h,u||typeof n!="function"?{type:"module"}:void 0);if(s.id=a,r&&(Array.isArray(r)?r.map(c=>{y(s,c,a,l)}):y(s,r,a,l)),p&&!E&&!T)s.onmessage=c=>{Promise.resolve().then(()=>{s.terminate(),URL.revokeObjectURL(h)}),W(c.data.message)},s.onerror=c=>{Promise.resolve().then(()=>{s.terminate(),URL.revokeObjectURL(h)}),S(new Error("Worker encountered an error: "+c.message))},s.postMessage({message:p,oneOff:!0},t);else{let c=M(s);W(c)}}})}function N(n){let u=location.pathname.split("/");u.pop();let p=location.origin+u.join("/")+"/";return typeof n=="string"?(n.startsWith("./")&&(n=p+n),n.includes("import")?`${n}`:`import '${n}';`):Array.isArray(n)?n.map(t=>(t.startsWith("./")&&(t=p+t),t.includes("import")?t:`import '${t}';`)).join(`
`):typeof n=="object"?Object.entries(n).map(([r,l])=>(r.startsWith("./")&&(r=p+r),typeof l=="string"?`import ${l} from '${r}';`:typeof l=="boolean"&&l?`import '${r}'`:`import { ${Object.entries(l).map(([E,T])=>typeof T=="string"?`${E} as ${T}`:E).join(", ")} } from '${r}';`)).join(`
`)+"":""}function y(n,u,p,t){let r=new MessageChannel;n.postMessage({COMMAND:{SENDER:r.port1,id:p,blocking:t}},[r.port1]),u.postMessage({COMMAND:{RECEIVER:r.port2,id:p,blocking:t}},[r.port2]),n.PORTS||(n.PORTS=[]),n.PORTS.push(u),u.PORTS||(u.PORTS=[]),u.PORTS.push(n)}var C=(n=()=>{})=>{globalThis.WORKER={};let u=(t,r,l)=>{if(globalThis.WORKER.SENDERS)for(let f in globalThis.WORKER.SENDERS){if(globalThis.WORKER.BLOCKING[f]){if(globalThis.WORKER.BLOCKED[f]){console.error("Thread Blocked: "+f);continue}globalThis.WORKER.BLOCKED[f]=!0}t?.message&&t?.transfer?globalThis.WORKER.SENDERS[f].postMessage({message:t.message,cb:r},t.transfer):globalThis.WORKER.SENDERS[f].postMessage({message:t,cb:r}),l&&postMessage(!0)}else t?.message&&t?.transfer?postMessage({message:t.message,cb:r},t.transfer):postMessage({message:t,cb:r})},p=(t,r)=>{let l=n(t.data?.message);l?.then?l.then(f=>{r&&r.postMessage(!0),u(f,t.data.cb,t.data.oneOff)}):(r&&r.postMessage(!0),u(l,t.data.cb,t.data.oneOff))};globalThis.onmessage=t=>{if(t.data?.COMMAND){let r=t.data.COMMAND;if(typeof r.SETLOOP=="number"){globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP);let l=()=>{p(t),globalThis.WORKER.LOOP=setTimeout(()=>{l()},r.SETLOOP)};l()}if(r.SETANIM){globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM);let l=()=>{p(t),globalThis.WORKER.ANIM=requestAnimationFrame(()=>{l()})};l()}if(r.STOP&&(globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP),globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM)),r.RECEIVER){let l=r.blocking;globalThis.WORKER.RECEIVERS||(globalThis.WORKER.RTCR=0,globalThis.WORKER.RECEIVERS={});let f=r.id;globalThis.WORKER.RECEIVERS[f]=r.RECEIVER,globalThis.WORKER.RTCR++,r.RECEIVER.onmessage=E=>{p(E,l?r.RECEIVER:void 0)},r.RECEIVER.onerror=E=>{delete globalThis.WORKER.RECEIVERS[f]}}if(r.SENDER){globalThis.WORKER.SENDERS||(globalThis.WORKER.PCTR=0,globalThis.WORKER.SENDERS={},globalThis.WORKER.BLOCKING={},globalThis.WORKER.BLOCKED={});let l=r.blocking,f=r.id?r.id:globalThis.WORKER.PCTR;globalThis.WORKER.SENDERS[f]=r.SENDER,globalThis.WORKER.PCTR++,l&&(globalThis.WORKER.BLOCKING[f]=!0),r.SENDER.onmessage=E=>{globalThis.WORKER.BLOCKING[f]&&(globalThis.WORKER.BLOCKED[f]=!1)},r.SENDER.onerror=E=>{delete globalThis.WORKER.SENDERS[f]}}r.DELETED&&(delete globalThis.WORKER.RECEIVERS?.[r.DELETED],delete globalThis.WORKER.SENDERS?.[r.DELETED])}else p(t)},globalThis.onerror=t=>{console.error(t)}},L=C.toString(),D=(n,u)=>{let p=L.replace("()=>{}",n.toString()),r=`${N(u)}
(${p})()`,l=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(l)},v=K;["threadop","initWorker"].forEach(n=>{k[n]&&(globalThis[n]=k[n])});})();
