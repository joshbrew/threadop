(()=>{var U=Object.defineProperty;var $=(t,c)=>{for(var l in c)U(t,l,{get:c[l],enumerable:!0})};var C={};$(C,{default:()=>w,generateWorkerURL:()=>j,initWorker:()=>v,recursivelyStringifyFunctions:()=>F,threadop:()=>B,workerFnString:()=>L});function B(t=l=>l,c){let l,h,W,e,s,b,n,y,E,k,M;if(t?.constructor?.name!=="Object"&&(l=t),t?.constructor?.name==="Object"||c){let O=c||t;O.operation&&(l=O.operation),h=O.imports,W=O.functions,e=O.message,s=O.transfer,b=O.port,n=O.blocking,y=O.pool,E=O.loop,k=O.animate,M=O.callback}return new Promise((O,A)=>{let N;if(typeof l!="function"){if(typeof l=="string"&&l.startsWith("./")){let f=location.origin,i=location.pathname.split("/");i.pop();let T=i.join("/");T.startsWith("http")?f+="/":f+=T+"/",l=f+l}N=l}else N=j(l,h,W);let x=f=>{let i={},T=!1;f.onmessage=o=>{for(let m in i)i[m](o.data.message,o.data.cb)},f.onerror=o=>{console.error(new Error("Worker encountered an error: "+o.message))};let d=(o,m,r,a)=>new Promise((p,u)=>{if(!r&&f.PORTS)f.postMessage({message:o,overridePort:r,fnName:a},m),p(!0);else{if(n){if(T)return new Promise((P,K)=>{K("Thread Blocked")});T=!0}let R=Math.floor(Math.random()*1e15);i[R]=(P,K)=>{R===K&&(delete i[R],n&&(T=!1),p(P))},f.postMessage({message:o,cb:R,overridePort:r},m)}}),g={run:(o,m,r)=>d(o,m,r),terminate:()=>{if(URL.revokeObjectURL(N),f.terminate(),f.PORTS){let o=(m,r)=>{m.postMessage({COMMAND:{DELETED:f.id}})};f.PORTS.forEach(o)}},addPort:o=>I(f,o,n),addCallback:(o=a=>{},m,r)=>{let a=Math.floor(Math.random()*1e15);return i[a]=m||r?(p,u)=>{(!r||u===r)&&o(p),m&&delete i[a]}:o,a},set:(o,m)=>(typeof o=="function"&&(o=o.toString()),d({setFunction:o,setFunctionName:m})),call:(o,m,r,a)=>d(m,r,a,o),removeCallback:o=>{delete g.callbacks[o]},setLoop:(o,m,r)=>{f.postMessage({message:m,COMMAND:{SETLOOP:o}},r)},setAnimation:(o,m)=>{f.postMessage({message:o,COMMAND:{SETANIM:!0}},m)},stop:()=>{f.postMessage({COMMAND:{STOP:!0}})},worker:f,callbacks:i,id:f.id};return M&&g.addCallback(M),E?g.setLoop(E,e,s):k&&g.setAnimation(e,s),g};if(y){let T=function(){let g=new Worker(N,h||typeof l!="function"?{type:"module"}:void 0),o=Math.floor(Math.random()*1e15);return g.id=o,f[o]=g,o},f={},i={};for(let g=0;g<y;g++)T();let d=Object.keys(f);if(b&&d.forEach((g,o)=>{let m=f[g];Array.isArray(b)?b.length===d.length?I(m,b[o],n):b.forEach(r=>{I(m,r,n)}):I(m,b,n)}),e&&!E&&!k)Promise.all(d.map((g,o)=>{let m=f[g],r=Array.isArray(e)?e[o]:e;return new Promise((a,p)=>{m.onmessage=R=>{Promise.resolve().then(()=>{m.terminate(),delete f[m.id]}),a(R.data.message)},m.onerror=R=>{Promise.resolve().then(()=>{m.terminate(),delete f[m.id]}),p(new Error("Worker encountered an error: "+R.message))};let u={message:r,oneOff:!0};m.postMessage(u,s)})})).then(g=>{URL.revokeObjectURL(N),O(g)}).catch(g=>{URL.revokeObjectURL(N),Object.keys(f).map((o,m)=>{let r=f[o];r&&r.terminate(),delete f[o],delete i.helpers?.[o]}),A(g)});else{let g=0,o=(r,a,p,u,R)=>{if(R)return u?i.helpers[R]?.call(u,r,a):i.helpers[R]?.run(r,a);if(Array.isArray(r)){let P=r.length,K=new Array(P);for(let S=0;S<P;S++){let D;u?D=i.helpers[R]?.call(u,r[S],a[S]):D=i.helpers[d[g]].run(r[S],a[S],p),g++,g>=d.length&&(g=0),K[S]=D}return K}else{let P;return u?P=i.helpers[d[g]].call(u,r,a,p):P=i.helpers[d[g]].run(r,a,p),g++,g>=d.length&&(g=0),P}};Object.assign(i,{workers:f,helpers:{},keys:d,run:(r,a,p,u)=>o(r,a,p,void 0,u),terminate:r=>{function a(p){i.helpers[p]?.terminate(),delete i.helpers[p],delete i.workers[p]}r?a(r):d.forEach(a)},set:(r,a)=>(typeof r=="function"&&(r=r.toString()),o({setFunction:r,setFunctionName:a})),call:(r,a,p,u,R)=>o(a,p,u,r,R),addWorker:()=>{let r=T(),a=f[r];return m(a),d.length=0,d.push(...d),r},addPort:(r,a)=>{function p(u){return i.helpers[u]?.addPort(r),!0}return a?p(a):d.map(p)},addCallback:(r,a,p,u)=>{function R(P){return i.helpers[P]?.addCallback(r,a,p)}return u?R(u):d.map(R)},removeCallback:(r,a)=>{function p(u){return i.helpers[u]?.removeCallback(r),!0}return a?p(a):d.map(p)},setLoop:(r,a,p,u)=>{function R(P){i.helpers[P]?.setLoop(r,a,p)}return u?R(u):d.map(R)},setAnimation:(r,a,p)=>{function u(R){i.helpers[R]?.setAnimation(r,a)}return p?u(p):d.map(u)},stop:r=>{function a(p){i.helpers[p]?.stop()}return r?a(r):d.map(a)}});let m=r=>{i.helpers[r.id]=x(r)};Object.keys(f).forEach((r,a)=>{m(f[r])}),O(i)}}else{let f=Math.floor(Math.random()*1e15),i=new Worker(N,h||typeof l!="function"?{type:"module"}:void 0);if(i.id=f,b&&(b.id||(b.id=Math.floor(Math.random()*1e15)),Array.isArray(b)?b.map(T=>{I(i,T,n)}):I(i,b,n)),e&&!E&&!k)i.onmessage=T=>{Promise.resolve().then(()=>{i.terminate(),URL.revokeObjectURL(N)}),O(T.data.message)},i.onerror=T=>{Promise.resolve().then(()=>{i.terminate(),URL.revokeObjectURL(N)}),A(new Error("Worker encountered an error: "+T.message))},i.postMessage({message:e,oneOff:!0},s);else{let T=x(i);O(T)}}})}function H(t){let c=location.pathname.split("/");c.pop();let l=location.origin+c.join("/")+"/";return typeof t=="string"?(t.startsWith("./")&&(t=l+t),t.includes("import")?`${t}`:`import '${t}';`):Array.isArray(t)?t.map(h=>(h.startsWith("./")&&(h=l+h),h.includes("import")?h:`import '${h}';`)).join(`
`):typeof t=="object"?Object.entries(t).map(([W,e])=>(W.startsWith("./")&&(W=l+W),typeof e=="string"?`import ${e} from '${W}';`:typeof e=="boolean"&&e?`import '${W}'`:`import { ${Object.entries(e).map(([b,n])=>typeof n=="string"?`${b} as ${n}`:b).join(", ")} } from '${W}';`)).join(`
`)+"":""}function I(t,c,l){let h=new MessageChannel;t.id||(t.id=Math.floor(Math.random()*1e15)),c.id||(c.id=Math.floor(Math.random()*1e15)),t.postMessage({COMMAND:{SENDER:h.port1,id:c.id,blocking:l}},[h.port1]),c.postMessage({COMMAND:{RECEIVER:h.port2,id:t.id,blocking:l}},[h.port2]),t.PORTS||(t.PORTS=[]),t.PORTS.push(c),c.PORTS||(c.PORTS=[]),c.PORTS.push(t)}var v=(t=()=>{},c={dummy:()=>{}})=>{globalThis.WORKER={FUNCTIONS:c},c&&Object.keys(c).forEach(e=>{c[e]=c[e].bind(globalThis.WORKER)});function l(e=""){let s=k=>{let M=k.indexOf("=>")+1;return M<=0&&(M=k.indexOf("){")),M<=0&&(M=k.indexOf(") {")),k.slice(0,k.indexOf("{",M)+1)},b=k=>k.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),n=s(e),y=b(e),E;if(n.includes("function")){let k=n.substring(n.indexOf("(")+1,n.lastIndexOf(")"));E=new Function(k,y)}else if(n.substring(0,6)===y.substring(0,6)){let k=n.substring(n.indexOf("(")+1,n.lastIndexOf(")"));E=new Function(k,y.substring(y.indexOf("{")+1,y.length-1))}else try{E=(0,eval)(e)}catch{}return E}t=t.bind(globalThis.WORKER);let h=(e,s,b,n,y)=>{if(globalThis.WORKER.SENDERS&&n!==!0)if(n!==void 0&&n!=="both")globalThis.WORKER.SENDERS[n]&&(e?.message?globalThis.WORKER.SENDERS[n].postMessage({message:e.message,overridePort:e?.overridePort,fnName:e?.fnName},e.transfer):globalThis.WORKER.SENDERS[n].postMessage({message:e,overridePort:e?.overridePort,fnName:e?.fnName}));else{for(let E in globalThis.WORKER.SENDERS){if(globalThis.WORKER.BLOCKING[E]){if(globalThis.WORKER.BLOCKED[E]){console.error("Thread Blocked: "+E);continue}globalThis.WORKER.BLOCKED[E]=!0}e?.message?globalThis.WORKER.SENDERS[E].postMessage({message:e.message,overridePort:e?.overridePort,fnName:e?.fnName},e.transfer):globalThis.WORKER.SENDERS[E].postMessage({message:e,overridePort:e?.overridePort,fnName:e?.fnName})}b&&postMessage(!0)}(!globalThis.WORKER.SENDERS||n===!0||n==="both")&&(e?.message?postMessage({message:e.message,cb:s,overridePort:e?.overridePort,fnName:y},e.transfer):postMessage({message:e,cb:s,overridePort:e?.overridePort,fnName:y}))},W=(e,s)=>{let b;if(e.data.setFunction){let n=l(e.data.setFunction).bind(globalThis.WORKER),y=e.data.setFunctionName||Math.floor(Math.random()*1e15);b=y,globalThis.WORKER.FUNCTIONS[y]=n}else if(e.data.fnName){let n=globalThis.WORKER.FUNCTIONS[e.data.fnName];n&&(b=n(e.data?.message))}else b=t(e.data?.message);b?.then?b.then(n=>{s&&s.postMessage(!0),h(n,e.data.cb,e.data.oneOff,e.data.overridePort,e.data.fnName)}):(s&&s.postMessage(!0),h(b,e.data.cb,e.data.oneOff,e.data.overridePort,e.data.fnName))};globalThis.onmessage=e=>{if(e.data?.COMMAND){let s=e.data.COMMAND;if(typeof s.SETLOOP=="number"){globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP);let b=()=>{W(e),globalThis.WORKER.LOOP=setTimeout(()=>{b()},s.SETLOOP)};b()}if(s.SETANIM){globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM);let b=()=>{W(e),globalThis.WORKER.ANIM=requestAnimationFrame(()=>{b()})};b()}if(s.STOP&&(globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP),globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM)),s.RECEIVER){let b=s.blocking;globalThis.WORKER.RECEIVERS||(globalThis.WORKER.RTCR=0,globalThis.WORKER.RECEIVERS={});let n=s.id;globalThis.WORKER.RECEIVERS[n]=s.RECEIVER,globalThis.WORKER.RTCR++,s.RECEIVER.onmessage=y=>{W(y,b?s.RECEIVER:void 0)},s.RECEIVER.onerror=y=>{delete globalThis.WORKER.RECEIVERS[n]}}if(s.SENDER){globalThis.WORKER.SENDERS||(globalThis.WORKER.PCTR=0,globalThis.WORKER.SENDERS={},globalThis.WORKER.BLOCKING={},globalThis.WORKER.BLOCKED={});let b=s.blocking,n=s.id?s.id:globalThis.WORKER.PCTR;globalThis.WORKER.SENDERS[n]=s.SENDER,globalThis.WORKER.PCTR++,b&&(globalThis.WORKER.BLOCKING[n]=!0),s.SENDER.onmessage=y=>{globalThis.WORKER.BLOCKING[n]&&(globalThis.WORKER.BLOCKED[n]=!1)},s.SENDER.onerror=y=>{delete globalThis.WORKER.SENDERS[n]}}s.DELETED&&(delete globalThis.WORKER.RECEIVERS?.[s.DELETED],delete globalThis.WORKER.SENDERS?.[s.DELETED])}else W(e)},globalThis.onerror=e=>{console.error(e)}},L=v.toString(),j=(t=()=>{},c,l)=>{let h=L.replace("()=>{}",t.toString());l&&L.replace("{dummy:()=>{}}",JSON.stringify(F(l)));let e=`${H(c)}

(${h})()`,s=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(s)},F=t=>{let c={};for(let l in t)typeof t[l]=="object"?c[l]=F(t[l]):typeof t[l]=="function"?c[l]=t[l].toString():c[l]=t[l];return c},w=B;["threadop","initWorker"].forEach(t=>{C[t]&&(globalThis[t]=C[t])});})();
