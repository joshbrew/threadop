(()=>{var B=Object.defineProperty;var U=(n,u)=>{for(var p in u)B(n,p,{get:u[p],enumerable:!0})};var C={};U(C,{default:()=>$,generateWorkerURL:()=>v,initWorker:()=>x,recursivelyStringifyFunctions:()=>L,threadop:()=>F,workerFnString:()=>I});function F(n=y=>y,{imports:u,functions:p,message:c,transfer:O,port:e,blocking:a,pool:d,loop:o,animate:E,callback:W}={}){return new Promise((y,M)=>{let P;if(typeof n!="function"){if(typeof n=="string"&&n.startsWith("./")){let l=location.origin,i=location.pathname.split("/");i.pop();let T=i.join("/");T.startsWith("http")?l+="/":l+=T+"/",n=l+n}P=n}else P=v(n,u,p);let A=l=>{let i={},T=!1;l.onmessage=t=>{for(let f in i)i[f](t.data.message,t.data.cb)},l.onerror=t=>{console.error(new Error("Worker encountered an error: "+t.message))};let R=(t,f,r,s)=>new Promise((b,m)=>{if(!r&&l.PORTS)l.postMessage({message:t,overridePort:r,fnName:s},f),b(!0);else{if(a){if(T)return new Promise((k,S)=>{S("Thread Blocked")});T=!0}let h=Math.floor(Math.random()*1e15);i[h]=(k,S)=>{h===S&&(delete i[h],a&&(T=!1),b(k))},l.postMessage({message:t,cb:h,overridePort:r},f)}}),g={run:(t,f,r)=>R(t,f,r),terminate:()=>{if(URL.revokeObjectURL(P),l.terminate(),l.PORTS){let t=(f,r)=>{f.postMessage({COMMAND:{DELETED:l.id}})};l.PORTS.forEach(t)}},addPort:t=>K(l,t,a),addCallback:(t=s=>{},f,r)=>{let s=Math.floor(Math.random()*1e15);return i[s]=f||r?(b,m)=>{(!r||m===r)&&t(b),f&&delete i[s]}:t,s},set:(t,f)=>(typeof t=="function"&&(t=t.toString()),R({setFunction:t,setFunctionName:f})),call:(t,f,r,s)=>R(f,r,s,t),removeCallback:t=>{delete g.callbacks[t]},setLoop:(t,f,r)=>{l.postMessage({message:f,COMMAND:{SETLOOP:t}},r)},setAnimation:(t,f)=>{l.postMessage({message:t,COMMAND:{SETANIM:!0}},f)},stop:()=>{l.postMessage({COMMAND:{STOP:!0}})},worker:l,callbacks:i,id:l.id};return W&&g.addCallback(W),o?g.setLoop(o,c,O):E&&g.setAnimation(c,O),g};if(d){let T=function(){let g=new Worker(P,u||typeof n!="function"?{type:"module"}:void 0),t=Math.floor(Math.random()*1e15);return g.id=t,l[t]=g,t},l={},i={};for(let g=0;g<d;g++)T();let R=Object.keys(l);if(e&&R.forEach((g,t)=>{let f=l[g];Array.isArray(e)?e.length===R.length?K(f,e[t],a):e.forEach(r=>{K(f,r,a)}):K(f,e,a)}),c&&!o&&!E)Promise.all(R.map((g,t)=>{let f=l[g],r=Array.isArray(c)?c[t]:c;return new Promise((s,b)=>{f.onmessage=h=>{Promise.resolve().then(()=>{f.terminate(),delete l[f.id]}),s(h.data.message)},f.onerror=h=>{Promise.resolve().then(()=>{f.terminate(),delete l[f.id]}),b(new Error("Worker encountered an error: "+h.message))};let m={message:r,oneOff:!0};f.postMessage(m,O)})})).then(g=>{URL.revokeObjectURL(P),y(g)}).catch(g=>{URL.revokeObjectURL(P),Object.keys(l).map((t,f)=>{let r=l[t];r&&r.terminate(),delete l[t],delete i.helpers?.[t]}),M(g)});else{let g=0,t=(r,s,b,m,h)=>{if(h)return m?i.helpers[h]?.call(m,r,s):i.helpers[h]?.run(r,s);if(Array.isArray(r)){let k=r.length,S=new Array(k);for(let N=0;N<k;N++){let D;m?D=i.helpers[h]?.call(m,r[N],s[N]):D=i.helpers[R[g]].run(r[N],s[N],b),g++,g>=R.length&&(g=0),S[N]=D}return S}else{let k;return m?k=i.helpers[R[g]].call(m,r,s,b):k=i.helpers[R[g]].run(r,s,b),g++,g>=R.length&&(g=0),k}};Object.assign(i,{workers:l,helpers:{},keys:R,run:(r,s,b,m)=>t(r,s,b,void 0,m),terminate:r=>{function s(b){i.helpers[b]?.terminate(),delete i.helpers[b],delete i.workers[b]}r?s(r):R.forEach(s)},set:(r,s)=>(typeof r=="function"&&(r=r.toString()),t({setFunction:r,setFunctionName:s})),call:(r,s,b,m,h)=>t(s,b,m,r,h),addWorker:()=>{let r=T(),s=l[r];return f(s),R.length=0,R.push(...R),r},addPort:(r,s)=>{function b(m){return i.helpers[m]?.addPort(r),!0}return s?b(s):R.map(b)},addCallback:(r,s,b,m)=>{function h(k){return i.helpers[k]?.addCallback(r,s,b)}return m?h(m):R.map(h)},removeCallback:(r,s)=>{function b(m){return i.helpers[m]?.removeCallback(r),!0}return s?b(s):R.map(b)},setLoop:(r,s,b,m)=>{function h(k){i.helpers[k]?.setLoop(r,s,b)}return m?h(m):R.map(h)},setAnimation:(r,s,b)=>{function m(h){i.helpers[h]?.setAnimation(r,s)}return b?m(b):R.map(m)},stop:r=>{function s(b){i.helpers[b]?.stop()}return r?s(r):R.map(s)}});let f=r=>{i.helpers[r.id]=A(r)};Object.keys(l).forEach((r,s)=>{f(l[r])}),y(i)}}else{let l=Math.floor(Math.random()*1e15),i=new Worker(P,u||typeof n!="function"?{type:"module"}:void 0);if(i.id=l,e&&(e.id||(e.id=Math.floor(Math.random()*1e15)),Array.isArray(e)?e.map(T=>{K(i,T,a)}):K(i,e,a)),c&&!o&&!E)i.onmessage=T=>{Promise.resolve().then(()=>{i.terminate(),URL.revokeObjectURL(P)}),y(T.data.message)},i.onerror=T=>{Promise.resolve().then(()=>{i.terminate(),URL.revokeObjectURL(P)}),M(new Error("Worker encountered an error: "+T.message))},i.postMessage({message:c,oneOff:!0},O);else{let T=A(i);y(T)}}})}function j(n){let u=location.pathname.split("/");u.pop();let p=location.origin+u.join("/")+"/";return typeof n=="string"?(n.startsWith("./")&&(n=p+n),n.includes("import")?`${n}`:`import '${n}';`):Array.isArray(n)?n.map(c=>(c.startsWith("./")&&(c=p+c),c.includes("import")?c:`import '${c}';`)).join(`
`):typeof n=="object"?Object.entries(n).map(([O,e])=>(O.startsWith("./")&&(O=p+O),typeof e=="string"?`import ${e} from '${O}';`:typeof e=="boolean"&&e?`import '${O}'`:`import { ${Object.entries(e).map(([d,o])=>typeof o=="string"?`${d} as ${o}`:d).join(", ")} } from '${O}';`)).join(`
`)+"":""}function K(n,u,p){let c=new MessageChannel;n.id||(n.id=Math.floor(Math.random()*1e15)),u.id||(u.id=Math.floor(Math.random()*1e15)),n.postMessage({COMMAND:{SENDER:c.port1,id:u.id,blocking:p}},[c.port1]),u.postMessage({COMMAND:{RECEIVER:c.port2,id:n.id,blocking:p}},[c.port2]),n.PORTS||(n.PORTS=[]),n.PORTS.push(u),u.PORTS||(u.PORTS=[]),u.PORTS.push(n)}var x=(n=()=>{},u={dummy:()=>{}})=>{globalThis.WORKER={FUNCTIONS:u},u&&Object.keys(u).forEach(e=>{u[e]=u[e].bind(globalThis.WORKER)});function p(e=""){let a=y=>{let M=y.indexOf("=>")+1;return M<=0&&(M=y.indexOf("){")),M<=0&&(M=y.indexOf(") {")),y.slice(0,y.indexOf("{",M)+1)},d=y=>y.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),o=a(e),E=d(e),W;if(o.includes("function")){let y=o.substring(o.indexOf("(")+1,o.lastIndexOf(")"));W=new Function(y,E)}else if(o.substring(0,6)===E.substring(0,6)){let y=o.substring(o.indexOf("(")+1,o.lastIndexOf(")"));W=new Function(y,E.substring(E.indexOf("{")+1,E.length-1))}else try{W=(0,eval)(e)}catch{}return W}n=n.bind(globalThis.WORKER);let c=(e,a,d,o,E)=>{if(globalThis.WORKER.SENDERS&&o!==!0)if(o!==void 0&&o!=="both")globalThis.WORKER.SENDERS[o]&&(e?.message?globalThis.WORKER.SENDERS[o].postMessage({message:e.message,overridePort:e?.overridePort,fnName:e?.fnName},e.transfer):globalThis.WORKER.SENDERS[o].postMessage({message:e,overridePort:e?.overridePort,fnName:e?.fnName}));else{for(let W in globalThis.WORKER.SENDERS){if(globalThis.WORKER.BLOCKING[W]){if(globalThis.WORKER.BLOCKED[W]){console.error("Thread Blocked: "+W);continue}globalThis.WORKER.BLOCKED[W]=!0}e?.message?globalThis.WORKER.SENDERS[W].postMessage({message:e.message,overridePort:e?.overridePort,fnName:e?.fnName},e.transfer):globalThis.WORKER.SENDERS[W].postMessage({message:e,overridePort:e?.overridePort,fnName:e?.fnName})}d&&postMessage(!0)}(!globalThis.WORKER.SENDERS||o===!0||o==="both")&&(e?.message?postMessage({message:e.message,cb:a,overridePort:e?.overridePort,fnName:E},e.transfer):postMessage({message:e,cb:a,overridePort:e?.overridePort,fnName:E}))},O=(e,a)=>{let d;if(e.data.setFunction){let o=p(e.data.setFunction).bind(globalThis.WORKER),E=e.data.setFunctionName||Math.floor(Math.random()*1e15);d=E,globalThis.WORKER.FUNCTIONS[E]=o}else if(e.data.fnName){let o=globalThis.WORKER.FUNCTIONS[e.data.fnName];o&&(d=o(e.data?.message))}else d=n(e.data?.message);d?.then?d.then(o=>{a&&a.postMessage(!0),c(o,e.data.cb,e.data.oneOff,e.data.overridePort,e.data.fnName)}):(a&&a.postMessage(!0),c(d,e.data.cb,e.data.oneOff,e.data.overridePort,e.data.fnName))};globalThis.onmessage=e=>{if(e.data?.COMMAND){let a=e.data.COMMAND;if(typeof a.SETLOOP=="number"){globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP);let d=()=>{O(e),globalThis.WORKER.LOOP=setTimeout(()=>{d()},a.SETLOOP)};d()}if(a.SETANIM){globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM);let d=()=>{O(e),globalThis.WORKER.ANIM=requestAnimationFrame(()=>{d()})};d()}if(a.STOP&&(globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP),globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM)),a.RECEIVER){let d=a.blocking;globalThis.WORKER.RECEIVERS||(globalThis.WORKER.RTCR=0,globalThis.WORKER.RECEIVERS={});let o=a.id;globalThis.WORKER.RECEIVERS[o]=a.RECEIVER,globalThis.WORKER.RTCR++,a.RECEIVER.onmessage=E=>{O(E,d?a.RECEIVER:void 0)},a.RECEIVER.onerror=E=>{delete globalThis.WORKER.RECEIVERS[o]}}if(a.SENDER){globalThis.WORKER.SENDERS||(globalThis.WORKER.PCTR=0,globalThis.WORKER.SENDERS={},globalThis.WORKER.BLOCKING={},globalThis.WORKER.BLOCKED={});let d=a.blocking,o=a.id?a.id:globalThis.WORKER.PCTR;globalThis.WORKER.SENDERS[o]=a.SENDER,globalThis.WORKER.PCTR++,d&&(globalThis.WORKER.BLOCKING[o]=!0),a.SENDER.onmessage=E=>{globalThis.WORKER.BLOCKING[o]&&(globalThis.WORKER.BLOCKED[o]=!1)},a.SENDER.onerror=E=>{delete globalThis.WORKER.SENDERS[o]}}a.DELETED&&(delete globalThis.WORKER.RECEIVERS?.[a.DELETED],delete globalThis.WORKER.SENDERS?.[a.DELETED])}else O(e)},globalThis.onerror=e=>{console.error(e)}},I=x.toString(),v=(n=()=>{},u,p)=>{let c=I.replace("()=>{}",n.toString());p&&I.replace("{dummy:()=>{}}",JSON.stringify(L(p)));let e=`${j(u)}

(${c})()`,a=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(a)},L=n=>{let u={};for(let p in n)typeof n[p]=="object"?u[p]=L(n[p]):typeof n[p]=="function"?u[p]=n[p].toString():u[p]=n[p];return u},$=F;["threadop","initWorker"].forEach(n=>{C[n]&&(globalThis[n]=C[n])});})();
