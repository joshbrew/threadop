function x(i=f=>f,u){let f,h,W,e,a,l,n,y,E,k,M;if(i?.constructor?.name!=="Object"&&(f=i),i?.constructor?.name==="Object"||u){let O=u||i;O.operation&&(f=O.operation),h=O.imports,W=O.functions,e=O.message,a=O.transfer,l=O.port,n=O.blocking,y=O.pool,E=O.loop,k=O.animate,M=O.callback}return new Promise((O,D)=>{let N;if(typeof f!="function"){if(typeof f=="string"&&f.startsWith("./")){let b=location.origin,s=location.pathname.split("/");s.pop();let T=s.join("/");T.startsWith("http")?b+="/":b+=T+"/",f=b+f}N=f}else N=j(f,h,W);let L=b=>{let s={},T=!1;b.onmessage=o=>{for(let m in s)s[m](o.data.message,o.data.cb)},b.onerror=o=>{console.error(new Error("Worker encountered an error: "+o.message))};let d=(o,m,r,t)=>new Promise((g,p)=>{if(!r&&b.PORTS)b.postMessage({message:o,overridePort:r,fnName:t},m),g(!0);else{if(n){if(T)return new Promise((P,K)=>{K("Thread Blocked")});T=!0}let R=Math.floor(Math.random()*1e15);s[R]=(P,K)=>{R===K&&(delete s[R],n&&(T=!1),g(P))},b.postMessage({message:o,cb:R,overridePort:r},m)}}),c={run:(o,m,r)=>d(o,m,r),terminate:()=>{if(URL.revokeObjectURL(N),b.terminate(),b.PORTS){let o=(m,r)=>{m.postMessage({COMMAND:{DELETED:b.id}})};b.PORTS.forEach(o)}},addPort:o=>I(b,o,n),addCallback:(o=t=>{},m,r)=>{let t=Math.floor(Math.random()*1e15);return s[t]=m||r?(g,p)=>{(!r||p===r)&&o(g),m&&delete s[t]}:o,t},set:(o,m)=>(typeof o=="function"&&(o=o.toString()),d({setFunction:o,setFunctionName:m})),call:(o,m,r,t)=>d(m,r,t,o),removeCallback:o=>{delete c.callbacks[o]},setLoop:(o,m,r)=>{b.postMessage({message:m,COMMAND:{SETLOOP:o}},r)},setAnimation:(o,m)=>{b.postMessage({message:o,COMMAND:{SETANIM:!0}},m)},stop:()=>{b.postMessage({COMMAND:{STOP:!0}})},worker:b,callbacks:s,id:b.id};return M&&c.addCallback(M),E?c.setLoop(E,e,a):k&&c.setAnimation(e,a),c};if(y){let T=function(){let c=new Worker(N,h||typeof f!="function"?{type:"module"}:void 0),o=Math.floor(Math.random()*1e15);return c.id=o,b[o]=c,o},b={},s={};for(let c=0;c<y;c++)T();let d=Object.keys(b);if(l&&d.forEach((c,o)=>{let m=b[c];Array.isArray(l)?l.length===d.length?I(m,l[o],n):l.forEach(r=>{I(m,r,n)}):I(m,l,n)}),e&&!E&&!k)Promise.all(d.map((c,o)=>{let m=b[c],r=Array.isArray(e)?e[o]:e;return new Promise((t,g)=>{m.onmessage=R=>{Promise.resolve().then(()=>{m.terminate(),delete b[m.id]}),t(R.data.message)},m.onerror=R=>{Promise.resolve().then(()=>{m.terminate(),delete b[m.id]}),g(new Error("Worker encountered an error: "+R.message))};let p={message:r,oneOff:!0};m.postMessage(p,a)})})).then(c=>{URL.revokeObjectURL(N),O(c)}).catch(c=>{URL.revokeObjectURL(N),Object.keys(b).map((o,m)=>{let r=b[o];r&&r.terminate(),delete b[o],delete s.helpers?.[o]}),D(c)});else{let c=0,o=(r,t,g,p,R)=>{if(R)return p?s.helpers[R]?.call(p,r,t):s.helpers[R]?.run(r,t);if(Array.isArray(r)){let P=r.length,K=new Array(P);for(let S=0;S<P;S++){let C;p?C=s.helpers[R]?.call(p,r[S],t[S]):C=s.helpers[d[c]].run(r[S],t[S],g),c++,c>=d.length&&(c=0),K[S]=C}return K}else{let P;return p?P=s.helpers[d[c]].call(p,r,t,g):P=s.helpers[d[c]].run(r,t,g),c++,c>=d.length&&(c=0),P}};Object.assign(s,{workers:b,helpers:{},keys:d,run:(r,t,g,p)=>o(r,t,g,void 0,p),terminate:r=>{function t(g){s.helpers[g]?.terminate(),delete s.helpers[g],delete s.workers[g]}r?t(r):d.forEach(t)},set:(r,t)=>(typeof r=="function"&&(r=r.toString()),o({setFunction:r,setFunctionName:t})),call:(r,t,g,p,R)=>o(t,g,p,r,R),addWorker:()=>{let r=T(),t=b[r];return m(t),d.length=0,d.push(...d),r},addPort:(r,t)=>{function g(p){return s.helpers[p]?.addPort(r),!0}return t?g(t):d.map(g)},addCallback:(r,t,g,p)=>{function R(P){return s.helpers[P]?.addCallback(r,t,g)}return p?R(p):d.map(R)},removeCallback:(r,t)=>{function g(p){return s.helpers[p]?.removeCallback(r),!0}return t?g(t):d.map(g)},setLoop:(r,t,g,p)=>{function R(P){s.helpers[P]?.setLoop(r,t,g)}return p?R(p):d.map(R)},setAnimation:(r,t,g)=>{function p(R){s.helpers[R]?.setAnimation(r,t)}return g?p(g):d.map(p)},stop:r=>{function t(g){s.helpers[g]?.stop()}return r?t(r):d.map(t)}});let m=r=>{s.helpers[r.id]=L(r)};Object.keys(b).forEach((r,t)=>{m(b[r])}),O(s)}}else{let b=Math.floor(Math.random()*1e15),s=new Worker(N,h||typeof f!="function"?{type:"module"}:void 0);if(s.id=b,l&&(l.id||(l.id=Math.floor(Math.random()*1e15)),Array.isArray(l)?l.map(T=>{I(s,T,n)}):I(s,l,n)),e&&!E&&!k)s.onmessage=T=>{Promise.resolve().then(()=>{s.terminate(),URL.revokeObjectURL(N)}),O(T.data.message)},s.onerror=T=>{Promise.resolve().then(()=>{s.terminate(),URL.revokeObjectURL(N)}),D(new Error("Worker encountered an error: "+T.message))},s.postMessage({message:e,oneOff:!0},a);else{let T=L(s);O(T)}}})}function B(i){let u=location.pathname.split("/");u.pop();let f=location.origin+u.join("/")+"/";return typeof i=="string"?(i.startsWith("./")&&(i=f+i),i.includes("import")?`${i}`:`import '${i}';`):Array.isArray(i)?i.map(h=>(h.startsWith("./")&&(h=f+h),h.includes("import")?h:`import '${h}';`)).join(`
`):typeof i=="object"?Object.entries(i).map(([W,e])=>(W.startsWith("./")&&(W=f+W),typeof e=="string"?`import ${e} from '${W}';`:typeof e=="boolean"&&e?`import '${W}'`:`import { ${Object.entries(e).map(([l,n])=>typeof n=="string"?`${l} as ${n}`:l).join(", ")} } from '${W}';`)).join(`
`)+"":""}function I(i,u,f){let h=new MessageChannel;i.id||(i.id=Math.floor(Math.random()*1e15)),u.id||(u.id=Math.floor(Math.random()*1e15)),i.postMessage({COMMAND:{SENDER:h.port1,id:u.id,blocking:f}},[h.port1]),u.postMessage({COMMAND:{RECEIVER:h.port2,id:i.id,blocking:f}},[h.port2]),i.PORTS||(i.PORTS=[]),i.PORTS.push(u),u.PORTS||(u.PORTS=[]),u.PORTS.push(i)}var v=(i=()=>{},u={dummy:()=>{}})=>{globalThis.WORKER={FUNCTIONS:u},u&&Object.keys(u).forEach(e=>{u[e]=u[e].bind(globalThis.WORKER)});function f(e=""){let a=k=>{let M=k.indexOf("=>")+1;return M<=0&&(M=k.indexOf("){")),M<=0&&(M=k.indexOf(") {")),k.slice(0,k.indexOf("{",M)+1)},l=k=>k.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),n=a(e),y=l(e),E;if(n.includes("function")){let k=n.substring(n.indexOf("(")+1,n.lastIndexOf(")"));E=new Function(k,y)}else if(n.substring(0,6)===y.substring(0,6)){let k=n.substring(n.indexOf("(")+1,n.lastIndexOf(")"));E=new Function(k,y.substring(y.indexOf("{")+1,y.length-1))}else try{E=(0,eval)(e)}catch{}return E}i=i.bind(globalThis.WORKER);let h=(e,a,l,n,y)=>{if(globalThis.WORKER.SENDERS&&n!==!0)if(n!==void 0&&n!=="both")globalThis.WORKER.SENDERS[n]&&(e?.message?globalThis.WORKER.SENDERS[n].postMessage({message:e.message,overridePort:e?.overridePort,fnName:e?.fnName},e.transfer):globalThis.WORKER.SENDERS[n].postMessage({message:e,overridePort:e?.overridePort,fnName:e?.fnName}));else{for(let E in globalThis.WORKER.SENDERS){if(globalThis.WORKER.BLOCKING[E]){if(globalThis.WORKER.BLOCKED[E]){console.error("Thread Blocked: "+E);continue}globalThis.WORKER.BLOCKED[E]=!0}e?.message?globalThis.WORKER.SENDERS[E].postMessage({message:e.message,overridePort:e?.overridePort,fnName:e?.fnName},e.transfer):globalThis.WORKER.SENDERS[E].postMessage({message:e,overridePort:e?.overridePort,fnName:e?.fnName})}l&&postMessage(!0)}(!globalThis.WORKER.SENDERS||n===!0||n==="both")&&(e?.message?postMessage({message:e.message,cb:a,overridePort:e?.overridePort,fnName:y},e.transfer):postMessage({message:e,cb:a,overridePort:e?.overridePort,fnName:y}))},W=(e,a)=>{let l;if(e.data.setFunction){let n=f(e.data.setFunction).bind(globalThis.WORKER),y=e.data.setFunctionName||Math.floor(Math.random()*1e15);l=y,globalThis.WORKER.FUNCTIONS[y]=n}else if(e.data.fnName){let n=globalThis.WORKER.FUNCTIONS[e.data.fnName];n&&(Array.isArray(e.data?.message)?l=n(...e.data.message):l=n(e.data?.message))}else l=i(e.data?.message);l?.then?l.then(n=>{a&&a.postMessage(!0),h(n,e.data.cb,e.data.oneOff,e.data.overridePort,e.data.fnName)}):(a&&a.postMessage(!0),h(l,e.data.cb,e.data.oneOff,e.data.overridePort,e.data.fnName))};globalThis.onmessage=e=>{if(e.data?.COMMAND){let a=e.data.COMMAND;if(typeof a.SETLOOP=="number"){globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP);let l=()=>{W(e),globalThis.WORKER.LOOP=setTimeout(()=>{l()},a.SETLOOP)};l()}if(a.SETANIM){globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM);let l=()=>{W(e),globalThis.WORKER.ANIM=requestAnimationFrame(()=>{l()})};l()}if(a.STOP&&(globalThis.WORKER.LOOP&&clearTimeout(globalThis.WORKER.LOOP),globalThis.WORKER.ANIM&&cancelAnimationFrame(globalThis.WORKER.ANIM)),a.RECEIVER){let l=a.blocking;globalThis.WORKER.RECEIVERS||(globalThis.WORKER.RTCR=0,globalThis.WORKER.RECEIVERS={});let n=a.id;globalThis.WORKER.RECEIVERS[n]=a.RECEIVER,globalThis.WORKER.RTCR++,a.RECEIVER.onmessage=y=>{W(y,l?a.RECEIVER:void 0)},a.RECEIVER.onerror=y=>{delete globalThis.WORKER.RECEIVERS[n]}}if(a.SENDER){globalThis.WORKER.SENDERS||(globalThis.WORKER.PCTR=0,globalThis.WORKER.SENDERS={},globalThis.WORKER.BLOCKING={},globalThis.WORKER.BLOCKED={});let l=a.blocking,n=a.id?a.id:globalThis.WORKER.PCTR;globalThis.WORKER.SENDERS[n]=a.SENDER,globalThis.WORKER.PCTR++,l&&(globalThis.WORKER.BLOCKING[n]=!0),a.SENDER.onmessage=y=>{globalThis.WORKER.BLOCKING[n]&&(globalThis.WORKER.BLOCKED[n]=!1)},a.SENDER.onerror=y=>{delete globalThis.WORKER.SENDERS[n]}}a.DELETED&&(delete globalThis.WORKER.RECEIVERS?.[a.DELETED],delete globalThis.WORKER.SENDERS?.[a.DELETED])}else W(e)},globalThis.onerror=e=>{console.error(e)}},F=v.toString(),j=(i=()=>{},u,f)=>{let h=F.replace("()=>{}",i.toString());f&&F.replace("{dummy:()=>{}}",JSON.stringify(A(f)));let e=`${B(u)}

(${h})()`,a=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(a)},A=i=>{let u={};for(let f in i)typeof i[f]=="object"?u[f]=A(i[f]):typeof i[f]=="function"?u[f]=i[f].toString():u[f]=i[f];return u},U=x;export{U as default,j as generateWorkerURL,v as initWorker,A as recursivelyStringifyFunctions,x as threadop,F as workerFnString};
