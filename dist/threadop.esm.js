function N(f=k=>k,{imports:y,message:g,transfer:h,port:c,blocking:m,pool:W}={}){return new Promise((k,S)=>{let L=(()=>{let d=(r,s)=>{if(globalThis.SENDERS)for(let a in globalThis.SENDERS){if(globalThis.BLOCKING[a]){if(globalThis.BLOCKED[a]){console.error("Thread Blocked: "+a);continue}globalThis.BLOCKED[a]=!0}globalThis.SENDERS[a].postMessage({message:r,cb:s})}else postMessage({message:r,cb:s})},t=(r,s)=>{let a=(()=>{})(r.data?.message);a?.then?a.then(l=>{s&&s.postMessage(!0),d(l,r.data.cb)}):(s&&s.postMessage(!0),d(a,r.data.cb)),r.data.oneOff&&globalThis.SENDERS&&postMessage(!0)};globalThis.onmessage=r=>{if(r.data?.RECEIVER){let s=r.data.blocking;globalThis.RECEIVERS||(globalThis.RTCR=0,globalThis.RECEIVERS={});let a=r.data.id;globalThis.RECEIVERS[a]=r.data.RECEIVER,globalThis.RTCR++,r.data.RECEIVER.onmessage=l=>{t(l,s?r.data.RECEIVER:void 0)},r.data.RECEIVER.onerror=l=>{delete globalThis.RECEIVER[a]}}else if(r.data?.SENDER){globalThis.SENDERS||(globalThis.PCTR=0,globalThis.SENDERS={},globalThis.BLOCKING={},globalThis.BLOCKED={});let s=r.data.blocking,a=r.data.id?r.data.id:globalThis.PCTR;globalThis.SENDERS[a]=r.data.SENDER,globalThis.PCTR++,s&&(globalThis.BLOCKING[a]=!0),r.data.SENDER.onmessage=l=>{globalThis.BLOCKING[a]&&(globalThis.BLOCKED[a]=!1)},r.data.SENDER.onerror=l=>{delete globalThis.SENDERS[a]}}else r.data?.DELETED?(delete globalThis.RECEIVERS?.[r.data.DELETED],delete globalThis.SENDERS?.[r.data.DELETED]):t(r)},globalThis.onerror=r=>{console.error(r)}}).toString().replace("()=>{}",f.toString()),M=`${w(y)}
(${L})()`,j=new Blob([M],{type:"application/javascript"}),T=URL.createObjectURL(j);if(W){let r=function(){let a=new Worker(T,y?{type:"module"}:void 0),l=Math.random();return a.id=l,d[l]=a,l},d={},t={};for(let a=0;a<W;a++)r();let s=Object.keys(d);if(c&&s.forEach((a,l)=>{let n=d[a];Array.isArray(c)?P(n,c[l],n.id,m):P(n,c,n.id,m)}),g)Promise.all(s.map((a,l)=>{let n=d[a],e=Array.isArray(g)?g[l]:g;return new Promise((o,i)=>{n.onmessage=p=>{Promise.resolve().then(()=>{n.terminate(),delete d[n.id]}),o(p.data.message)},n.onerror=p=>{Promise.resolve().then(()=>{n.terminate(),delete d[n.id]}),i(new Error("Worker encountered an error: "+p.message))},n.postMessage({message:e,oneOff:!0},h)})})).then(a=>{URL.revokeObjectURL(T),k(a)}).catch(a=>{URL.revokeObjectURL(T),Object.keys(d).map((l,n)=>{let e=d[l];e&&e.terminate(),delete d[l],delete t.helpers?.[l]}),S(a)});else{let a={},l=0;Object.assign(t,{workers:d,helpers:{},keys:s,run:(e,o,i)=>{if(i)t.helpers[i]?.run(e,o);else if(Array.isArray(e)){let p=e.length;for(let u=0;u<p;u++)t.helpers[s[l]].run(e[u],o[u]),l++,l>=s.length&&(l=0)}else t.helpers[s[l]].run(e,o),l++,l>=s.length&&(l=0)},terminate:e=>{function o(i){t.helpers[i]?.terminate(),delete t.helpers[i],delete t.workers[i]}e?o(e):s.forEach(o)},addWorker:()=>{let e=r(),o=d[e];return n(o),s.length=0,s.push(...s),e},addPort:(e,o)=>{function i(p){return t.helpers[p]?.addPort(e),!0}return o?i(o):s.map(i)},addCallback:(e,o,i)=>{function p(u){return t.helpers[u]?.addCallback(e,o)}return i?p(i):s.map(p)},removeCallback:(e,o)=>{function i(p){return t.helpers[p]?.removeCallback(e),!0}return o?i(o):s.map(i)},callbacks:a});let n=e=>{let o=!1,i={};e.onmessage=b=>{for(let E in i)i[E](b.data.message,b.data.cb)},e.onerror=b=>{console.error(new Error("Worker encountered an error: "+b.message))};let p=(b,E)=>new Promise((R,D)=>{if(e.PORTS)e.postMessage({message:b},E),R(!0);else{if(m){if(o)return new Promise((I,C)=>{C("Thread Blocked")});o=!0}let O=Math.random();i[O]=(I,C)=>{O===C&&(delete i[O],m&&(o=!1),R(I))},e.postMessage({message:b,cb:O},E)}}),u={run:(b,E)=>p(b,E),terminate:()=>{if(URL.revokeObjectURL(T),e.terminate(),delete d[e.id],delete t.helpers[e.id],e.PORTS){let b=(E,R)=>{E.postMessage({DELETED:e.id})};e.PORTS.forEach(b)}},addPort:b=>P(e,b,e.id,m),addCallback:(b=R=>{},E)=>{let R=Math.random();return u.callbacks[R]=E?D=>{b(D),delete u.callbacks[R]}:b,R},removeCallback:b=>{delete u.callbacks[b]},worker:e,callbacks:i};t.helpers[e.id]=u};Object.keys(d).forEach((e,o)=>{n(d[e])}),k(t)}}else{let d=Math.random(),t=new Worker(T,y?{type:"module"}:void 0);if(c&&(Array.isArray(c)?c.map(r=>{P(t,r,d,m)}):P(t,c,d,m)),g)t.onmessage=r=>{Promise.resolve().then(()=>{t.terminate(),URL.revokeObjectURL(T)}),k(r.data.message)},t.onerror=r=>{Promise.resolve().then(()=>{t.terminate(),URL.revokeObjectURL(T)}),S(new Error("Worker encountered an error: "+r.message))},t.postMessage({message:g,oneOff:!0},h);else{let r={},s=!1;t.onmessage=n=>{for(let e in r)r[e](n.data.message,n.data.cb)},t.onerror=n=>{console.error(new Error("Worker encountered an error: "+n.message))};let a=(n,e)=>new Promise((o,i)=>{if(t.PORTS)t.postMessage({message:n},e),o(!0);else{if(m){if(s)return new Promise((u,b)=>{b("Thread Blocked")});s=!0}let p=Math.random();r[p]=(u,b)=>{p===b&&(delete r[p],m&&(s=!1),o(u))},t.postMessage({message:n,cb:p},e)}}),l={run:(n,e)=>a(n,e),terminate:()=>{if(URL.revokeObjectURL(T),t.terminate(),t.PORTS){let n=(e,o)=>{e.postMessage({DELETED:d})};t.PORTS.forEach(n)}},addPort:n=>P(t,n,d,m),addCallback:(n=o=>{},e)=>{let o=Math.random();return r[o]=e?i=>{n(i),delete r[o]}:n,o},removeCallback:n=>{delete l.callbacks[n]},worker:t,callbacks:r};k(l)}}})}function w(f){let y=location.pathname.split("/");y.pop();let g=location.origin+y.join("/")+"/";return typeof f=="string"?(f.startsWith("./")&&(f=g+f),f.includes("import")?`${f}`:`import '${f}';`):Array.isArray(f)?f.map(h=>(h.startsWith("./")&&(h=g+h),h.includes("import")?h:`import '${h}';`)).join(`
`):typeof f=="object"?Object.entries(f).map(([c,m])=>(c.startsWith("./")&&(c=g+c),typeof m=="string"?`import ${m} from '${c}';`:typeof m=="boolean"&&m?`import '${c}'`:`import { ${Object.entries(m).map(([k,S])=>typeof S=="string"?`${k} as ${S}`:k).join(", ")} } from '${c}';`)).join(`
`)+"":""}function P(f,y,g,h){let c=new MessageChannel;f.postMessage({SENDER:c.port1,id:g,blocking:h},[c.port1]),y.postMessage({RECEIVER:c.port2,id:g,blocking:h},[c.port2]),f.PORTS||(f.PORTS=[]),f.PORTS.push(y),y.PORTS||(y.PORTS=[]),y.PORTS.push(f)}var $=N;export{$ as default,N as threadop};
